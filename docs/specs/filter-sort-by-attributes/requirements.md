# Requirements Document

## Introduction

パーツリストビューにおいて、エンドユーザーが共通項目（価格・重量・EN負荷）以外のスロット固有の属性でも自由にフィルター・ソートできる機能を実装します。これにより、より探索的なアセンブリ検討とパーツ選択を可能にします。

各スロット（右腕武器、左腕武器、頭部、脚部など）ごとに利用可能な属性は `attributes.ts` を参照して動的に決定し、各属性の `optional` フラグに基づいて適切な処理を行います。

### ビジネス価値

- **探索性の向上**: スロット固有の詳細な属性（攻撃力、射程、防御力など）でフィルタ・ソートすることで、ユーザーが多様な観点からパーツを比較・検討可能
- **アセンブリ最適化**: 特定の性能要件に基づいて最適なパーツを効率的に発見できる
- **ユーザビリティ向上**: スロットごとに意味のある属性のみを表示することで、不要な選択肢を排除し、目的のパーツに素早くアクセス可能
- **保守性向上**: 属性定義を一元管理することで、パーツデータの変更に自動的に追従

---

## Requirements

### Requirement 1: スロット固有の属性でフィルター・ソート

**Objective**: エンドユーザーとして、選択中のスロットに応じた固有の属性（攻撃力、射程、防御力、カテゴリ、製造企業など）でパーツをフィルター・ソートできるようにしたい。これにより、共通項目（価格・重量・EN負荷）だけでなく、より詳細な性能指標や分類で探索的にパーツを選択できる。

#### Acceptance Criteria

1. WHEN ユーザーが特定のスロット（例：右腕武器）を選択 THEN Parts List View SHALL そのスロット固有の属性（`valueType` が `"numeric"` と `"array"` の属性）をフィルター・ソート対象として提供し、`valueType` が `"literal"` の属性は除外
2. WHEN ユーザーがスロットを切り替え（例：右腕武器 → 頭部）THEN Parts List View SHALL 新しいスロット固有の属性（例：AP、防御力、スキャン距離、カテゴリ、製造企業）に即座に切り替え
3. WHEN フィルター・ソート可能な属性を表示 THEN Parts List View SHALL `attributes.ts` に定義されている順序通りに属性を表示
4. IF スロットに利用可能な属性が存在しない THEN Parts List View SHALL "利用可能な属性がありません" というメッセージを表示

---

### Requirement 2: 探索的なフィルタリング機能

**Objective**: エンドユーザーとして、スロット固有の詳細な性能指標（攻撃力、射程、防御力など）を使って、特定の条件に合うパーツを探索的に絞り込みたい。これにより、自分のアセンブリ方針に最適なパーツを効率的に発見できる。

#### Acceptance Criteria

1. WHEN ユーザーがフィルターパネルを開く THEN Filter Panel SHALL 現在選択中のスロット固有の属性（例：右腕武器なら「攻撃力」「射程」「連射速度」など）を選択肢として表示
2. WHEN ユーザーが `valueType` が `"numeric"` の属性（例：「攻撃力」「重量」）を選択 THEN Filter Panel SHALL 数値比較のUI（条件演算子：以上・以下・等しいなど + 数値入力欄）を提供
3. WHEN ユーザーが `valueType` が `"array"` の属性（例：「カテゴリ」「製造企業」）を選択 THEN Filter Panel SHALL そのスロットで利用可能な選択肢から選ぶUI（チェックボックスまたはドロップダウン）を提供
4. WHEN ユーザーが複数のフィルター条件を設定（例：「攻撃力 >= 1000」AND「重量 <= 500」AND「製造企業 = BAWS」）THEN Filter Panel SHALL 全ての条件を満たすパーツのみを表示
5. WHEN ユーザーがフィルターを適用 THEN Parts List View SHALL リアルタイムに絞り込み結果を表示し、該当件数を明示
6. WHEN ユーザーがスロットを変更 THEN Filter Panel SHALL 新しいスロットに対応する属性リストに即座に切り替え、既存のフィルターをクリア

---

### Requirement 3: 多様な観点でのソート機能

**Objective**: エンドユーザーとして、スロット固有の様々な属性（攻撃力、射程、防御力、カテゴリ、製造企業など）でパーツをソートして比較したい。これにより、数値性能だけでなく、分類によるソートも可能になり、多様な観点でパーツ選択を効率的に行える。

#### Acceptance Criteria

1. WHEN ユーザーがソートコントロールを開く THEN Sort Control SHALL 現在選択中のスロット固有の全属性（`valueType` が `"numeric"` と `"array"` の属性）を選択肢として表示
2. WHEN ユーザーが数値属性（`valueType` が `"numeric"`、例：「攻撃力」）を選択 THEN Sort Control SHALL 昇順・降順を選択できるUIを提供し、数値としてソート
3. WHEN ユーザーが配列属性（`valueType` が `"array"`、例：「カテゴリ」「製造企業」）を選択 THEN Sort Control SHALL 昇順・降順を選択できるUIを提供し、文字列としてソート
4. WHEN ユーザーがソートを適用 THEN Parts List View SHALL 選択された属性と順序でパーツを並び替えて表示
5. WHEN ユーザーがスロットを変更 THEN Sort Control SHALL 新しいスロットに対応する属性リストに即座に切り替え
6. IF 現在選択中のソート属性が新しいスロットで利用不可能 THEN Sort Control SHALL ソート設定を自動的にクリアし、デフォルト順序に戻す

---

### Requirement 4: 任意属性でのフィルタリング動作

**Objective**: エンドユーザーとして、一部のパーツにしか存在しない任意属性（例：チャージ攻撃力、誘導性能など）でフィルタリングする際に、期待通りの結果が得られるようにしたい。

#### Acceptance Criteria

1. WHEN ユーザーが任意属性（一部のパーツのみが持つ属性、例：「チャージ攻撃力」）でフィルターを設定 THEN Parts List View SHALL その属性を持つパーツのみを表示
2. WHEN ユーザーが任意属性でフィルターを適用 THEN Parts List View SHALL その属性を持たないパーツを自動的に除外
3. WHEN ユーザーが必須属性（全パーツが持つ属性、例：「価格」「重量」）でフィルターを設定 THEN Parts List View SHALL 全パーツを対象にフィルタリング
4. IF フィルター適用後に該当するパーツが0件 THEN Parts List View SHALL "フィルター条件に一致するパーツがありません" というメッセージを表示
5. WHEN ユーザーが複数のフィルター（必須属性 + 任意属性）を組み合わせて適用 THEN Parts List View SHALL 全ての条件を満たすパーツのみを表示

---

### Requirement 5: 任意属性でのソート動作

**Objective**: エンドユーザーとして、一部のパーツにしか存在しない任意属性（例：チャージ攻撃力、誘導性能など）でソートする際に、その属性を持つパーツを優先的に確認できるようにしたい。

#### Acceptance Criteria

1. WHEN ユーザーが任意属性（一部のパーツのみが持つ属性、例：「チャージ攻撃力」）でソートを実行 THEN Parts List View SHALL その属性を持つパーツを先頭に表示
2. WHEN 任意属性でソート THEN Parts List View SHALL 属性を持たないパーツを末尾にまとめて表示
3. WHEN 属性を持つパーツをソート THEN Parts List View SHALL 指定された順序（昇順 or 降順）に従って属性値でソート
4. WHEN 属性を持たないパーツを表示 THEN Parts List View SHALL 元の表示順序を維持
5. WHEN ユーザーが必須属性（全パーツが持つ属性、例：「価格」「重量」）でソートを実行 THEN Parts List View SHALL 全パーツを対象にソート

---

### Requirement 6: 属性翻訳とUI表示

**Objective**: パーツリストビューのユーザーとして、技術的な属性名ではなく、人間が理解しやすい日本語名で属性を確認したい。

#### Acceptance Criteria

1. WHEN 属性を UI に表示 THEN Parts List View SHALL 国際化（i18n）リソースから対応する翻訳を取得
2. IF 属性に対応する翻訳が存在しない THEN Parts List View SHALL 属性名をキャメルケース形式（例：attack_power → attackPower）に変換して表示
3. WHEN フィルターパネルで属性を選択 THEN Filter Panel SHALL 翻訳された属性名を表示（例："攻撃力", "重量", "EN負荷"）
4. WHEN ソートコントロールで属性を選択 THEN Sort Control SHALL 翻訳された属性名を表示
5. WHEN フィルター条件を文字列化して表示 THEN Filter Panel SHALL 翻訳された属性名を使用（例："攻撃力: >= 1000"）

---

### Requirement 7: 快適な操作性とレスポンス

**Objective**: エンドユーザーとして、スロット固有の属性でフィルター・ソートする際に、待ち時間やUIのフリーズを感じることなく、快適に探索できるようにしたい。

#### Acceptance Criteria

1. WHEN ユーザーがスロットを変更 THEN Parts List View SHALL 100ms 以内に新しい属性リストを表示
2. WHEN ユーザーがフィルター・ソートを適用 THEN Parts List View SHALL 処理中もUIが応答性を保ち、他の操作（スクロール、パネルの開閉など）が継続可能
3. WHEN ユーザーが同じスロットで複数回フィルター・ソートを実行 THEN Parts List View SHALL 毎回スムーズに結果を更新
4. WHEN ユーザーが大量のパーツ（100件以上）を扱う THEN Parts List View SHALL スクロール操作が滑らかで、一覧表示が遅延なく動作
5. WHEN ユーザーが属性名を表示 THEN Parts List View SHALL 翻訳が即座に適用され、待ち時間を感じさせない

---

## Non-Functional Requirements

### 互換性

- 既存のフィルター・ソート機能との後方互換性を維持
- URL パラメータでのフィルター・ソート状態の共有機能を維持

### 保守性

- `attributes.ts` の変更時に、UI コードの修正が不要
- 新しいスロットタイプの追加時に、最小限のコード変更で対応可能

### テスタビリティ

- 各属性取得関数が単独でテスト可能
- フィルタリング・ソートロジックが optional フラグの有無で正しく動作することをテストで検証

### アクセシビリティ

- 属性選択ドロップダウンがキーボード操作でアクセス可能
- スクリーンリーダーで属性名と選択状態が読み上げ可能

---

## Out of Scope

以下の項目は本要件の対象外とします：

- 新しい属性の追加やパーツデータそのものの変更
- 複数の属性による複合ソート（例：「攻撃力」でソート後、同値の場合は「重量」でソート）
- パーツ同士の詳細比較機能（別の機能として検討）
- フィルター・ソート条件の保存・共有機能の拡張（既存のURL共有機能で対応）
- パフォーマンスベンチマークの自動化やモニタリング
