# Requirements Document

## Introduction

パーツ一覧ページは、AC6 Assemble Toolにおける新しい探索的UI機能であり、スロット先行のアプローチによってパーツの一覧表示・フィルタリング・並び替えを実現します。本機能により、原作ゲームでは不可能だった「条件による探索」が可能となり、プレイヤーは効率的に自分のビルド方針に合うパーツを発見できます。

### ビジネス価値

- **探索効率の向上**: 原作のセレクトボックス方式では困難だった条件検索を実現
- **ユーザー体験の改善**: スロット文脈による無関係な情報の除外で認知負荷を軽減
- **コミュニティ連携**: URL共有による探索条件の共有で議論を促進
- **探索と組立の分離**: 一覧ページとアセンページの責務を明確に分離し、思考・UIの負担を軽減

### 参照ドキュメント

- `docs/specs/parts-list-view/request.md` - 要求定義（スロット先行・確定版）
- `docs/specs/parts-list-view/scenario.md` - ユーザーストーリー（原作ペイン前提込み）
- `docs/specs/parts-list-view/scenario-moscow.md` - ユーザーストーリー優先度（MoSCoW）

## Requirements

### Requirement 1: スロット選択による文脈確立（Must）
**Objective:** プレイヤーとして、最初にスロットを選択して当該スロットのパーツのみを一覧表示したい。無関係な情報を省き、効率的に探索できるようにするため。

#### Acceptance Criteria

1. WHEN パーツ一覧ページを開いた THEN パーツ一覧ページ SHALL 必ず1つのスロットが選択された状態で表示される
2. WHEN プレイヤーがスロットを選択した THEN パーツ一覧ページ SHALL 選択されたスロットに該当するパーツのみを一覧表示する
3. WHEN プレイヤーがスロットを切り替えた THEN パーツ一覧ページ SHALL 一覧・フィルタ・お気に入りの文脈を新しいスロットに切り替える
4. WHERE スロット未選択状態 THE パーツ一覧ページ SHALL 存在してはならない

### Requirement 2: 属性フィルタリング機能（Must）
**Objective:** プレイヤーとして、選択中スロットに存在する任意の属性を条件にして絞り込みたい。原作ではできなかった「条件検索」で効率的に候補を見つけるため。

#### Acceptance Criteria

1. WHEN スロットが選択されている THEN パーツ一覧ページ SHALL 当該スロットで意味を持つ属性のみをフィルタ項目として提示する
2. WHEN プレイヤーがフィルタ条件を適用した THEN パーツ一覧ページ SHALL 条件に該当しないパーツを非表示にする
3. WHERE パーツが特定の属性を持たない THE パーツ一覧ページ SHALL そのパーツをフィルタ対象外として扱う
4. WHEN フィルタ結果が0件になった THEN パーツ一覧ページ SHALL 結果が0件であることを明示する
5. WHEN スロットを切り替えた AND 前スロットのフィルタ条件が新スロットで無効 THEN パーツ一覧ページ SHALL 無効条件を自動的に除外し、有効な条件のみを引き継ぐ

### Requirement 3: フィルタ済み母集団のアセンページ受け渡し（Must）
**Objective:** プレイヤーとして、フィルタで絞り込んだ母集団をアセンページに渡し、その範囲でビルドを組みたい。絞り込みの文脈を維持したまま、ビルドを試行錯誤できるようにするため。

#### Acceptance Criteria

1. WHEN プレイヤーがフィルタ済み一覧からアセンページへ遷移した THEN パーツ一覧ページ SHALL フィルタ結果をスロットごとの母集団としてアセンページへ渡す
2. WHERE アセンページで選択可能なパーツ THE アセンページ SHALL パーツ一覧ページから渡された母集団のみを表示する
3. WHEN アセンページに遷移した THEN パーツ一覧ページ SHALL フィルタ条件の内容を保持する
4. WHERE 受け渡し単位 THE パーツ一覧ページ SHALL 常にスロット単位の母集団として扱い、複数スロットの混載を行わない

### Requirement 4: ゼロ件時の操作継続性（Must）
**Objective:** プレイヤーとして、フィルタ結果が0件でもスロットや主要条件をそのまま操作したい。条件を調整しながら探索を続けられるようにするため。

#### Acceptance Criteria

1. WHEN フィルタ結果が0件になった THEN パーツ一覧ページ SHALL スロット選択機能を利用可能な状態で維持する
2. WHEN フィルタ結果が0件になった THEN パーツ一覧ページ SHALL 主要条件の変更機能を利用可能な状態で維持する
3. WHEN フィルタ結果が0件になった THEN パーツ一覧ページ SHALL 0件であることを明示的に表示する
4. WHERE 0件時の操作性 THE パーツ一覧ページ SHALL エラー扱いせず、探索を継続可能な状態を維持する

### Requirement 5: 属性による並び替え機能（Should）
**Objective:** プレイヤーとして、選択中スロットで意味を持つ属性を基準に並び替えたい。原作と同じようにパーツを整理しつつ、より高精度な探索を行うため。

#### Acceptance Criteria

1. WHEN スロットが選択されている THEN パーツ一覧ページ SHALL 当該スロットの属性のみを並び替え項目として提示する
2. WHEN プレイヤーが並び替え条件を適用した THEN パーツ一覧ページ SHALL 指定された属性の値に基づいてパーツを並び替える
3. WHERE パーツが並び替え対象の属性を持たない THE パーツ一覧ページ SHALL そのパーツを序列外（末尾など）に配置する
4. WHEN 並び替え条件を設定した THEN パーツ一覧ページ SHALL 並び替え状態をURL・ローカルストレージに保持する

### Requirement 6: お気に入りによる探索整理（Should）
**Objective:** プレイヤーとして、気になったパーツをお気に入りに登録し、後からお気に入りだけで絞り込みたい。原作の「メモ」や「比較の記憶」をUIで補完するため。

#### Acceptance Criteria

1. WHEN プレイヤーがパーツをお気に入りに追加した THEN パーツ一覧ページ SHALL お気に入りをスロット単位で管理する
2. WHEN プレイヤーがお気に入りフィルタを適用した THEN パーツ一覧ページ SHALL お気に入り登録されたパーツのみを表示する
3. WHEN スロットを切り替えた THEN パーツ一覧ページ SHALL お気に入り集合も新しいスロットに対応したものに切り替える
4. WHERE お気に入り機能 THE パーツ一覧ページ SHALL お気に入りをフィルタの一種として扱う

### Requirement 7: 探索状態の保存・共有（Should）
**Objective:** プレイヤーとして、現在のフィルタ・並び順・スロット状態をURLとして共有したい。他プレイヤーに自分の探索条件を見せ、ビルド議論を行うため。

#### Acceptance Criteria

1. WHEN プレイヤーが探索状態を保持した THEN パーツ一覧ページ SHALL スロット・フィルタ条件・並び順をURLクエリパラメータに含める
2. WHEN 共有されたURLを開いた THEN パーツ一覧ページ SHALL URLから状態を復元し、同じ条件で一覧を再現する
3. WHERE URL共有の単位 THE パーツ一覧ページ SHALL 条件式（クエリ）を共有単位とし、結果スナップショットは含めない
4. WHEN URLから状態を復元した AND ローカルストレージにも状態が存在する THEN パーツ一覧ページ SHALL URLの状態を優先する

### Requirement 8: プライベート設定のローカル復元（Could）
**Objective:** プレイヤーとして、表示モード（grid/list）などのプライベート設定を再訪時に復元したい。個人の好みに合わせた表示を維持するため。

**Note:** スロット、フィルタ、並び替えはURL共有用のため、LocalStorageには保存せず、URLパラメータから復元する。

#### Acceptance Criteria

1. WHEN プレイヤーが表示モードを変更した THEN パーツ一覧ページ SHALL 表示モードをローカルストレージに自動保存する
2. WHEN ページを再訪した THEN パーツ一覧ページ SHALL ローカルストレージから表示モードを復元する
3. WHEN URLに探索状態（スロット、フィルタ、並び替え）が含まれている THEN パーツ一覧ページ SHALL URLから状態を復元し、表示モードのみローカルストレージから復元する

### Requirement 9: スロット切替時の条件明示（Could）
**Objective:** プレイヤーとして、スロットを切り替えたとき、どの条件が引き継がれ、どれが無効化されたかを理解したい。自分の探索文脈を見失わないようにするため。

#### Acceptance Criteria

1. WHEN スロットを切り替えた AND 一部の条件が新スロットで無効 THEN パーツ一覧ページ SHALL 無効化された条件をUI上で明示する
2. WHEN スロットを切り替えた THEN パーツ一覧ページ SHALL 新スロットで意味を持つ条件のみを引き継ぐ
3. WHERE 無効化された条件の扱い THE パーツ一覧ページ SHALL エラー扱いせず、情報として提示する
4. WHEN スロット切替により0件になった THEN パーツ一覧ページ SHALL 操作を継続可能な状態を維持する

## 非機能要件

### Performance
1. WHEN パーツ一覧を初回表示した THEN パーツ一覧ページ SHALL 3秒以内に表示を完了する
2. WHEN フィルタ・並び替え操作を実行した THEN パーツ一覧ページ SHALL 1秒以内に結果を表示する

### Usability
1. WHERE モバイル環境 THE パーツ一覧ページ SHALL 視認性・タップ操作性を確保する
2. WHERE 状態保持機能 THE パーツ一覧ページ SHALL URL・ローカルストレージへの反映を即時実行する

### Compatibility
1. WHERE ドメイン制約違反 THE パーツ一覧ページ SHALL エラーにせず、アセンページで自然に制約する
2. WHEN 複数のゲームパッチバージョンが存在する THEN パーツ一覧ページ SHALL 全バージョンのパーツデータをサポートする

### User Experience
1. WHEN ロード中または0件状態 THEN パーツ一覧ページ SHALL 状態を明確に表示する
2. WHERE 操作性全般 THE パーツ一覧ページ SHALL 原作プレイヤーが「AC6の探索を拡張している」と感じられる操作性を提供する

## 優先度サマリー（MoSCoW）

### Must（MVPで必須）
- Requirement 1: スロット選択による文脈確立
- Requirement 2: 属性フィルタリング機能
- Requirement 3: フィルタ済み母集団のアセンページ受け渡し
- Requirement 4: ゼロ件時の操作継続性

### Should（早期拡張で強く推奨）
- Requirement 5: 属性による並び替え機能
- Requirement 6: お気に入りによる探索整理
- Requirement 7: 探索状態の保存・共有

### Could（後追いで価値を高める）
- Requirement 8: 探索状態のローカル復元
- Requirement 9: スロット切替時の条件明示

### Won't（当面スコープ外）
- 結果スナップショットの共有（URLに結果を含める）
- 条件緩和の提案（フィルタヒント生成）
