# グローバルナビゲーションによるモード切替UIの導入

- ステータス: 提案中
- 日付: 2026-01-24
- タグ: ui, ux, layout, navigation, mobile, responsive

技術ストーリー: [UI改善方針](../specs/ui-improvement/PLAN.md)

## 背景 / 文脈

現在のUIでは、Assembly Tool / Parts List / AI Recommendation の3つの機能がそれぞれ独立したページとして存在し、ページ間の遷移はフッターのリンクに依存している。

しかし、これらは「別のアプリケーション」ではなく、**同一のアセンブル作業における異なる思考モード**である：

- **Assembly**: パーツを組み合わせてアセンブルを構築する
- **Parts**: 条件に合うパーツを探索・比較する
- **AI**: 自然言語でパーツ推奨を受ける

現状の問題：

1. モード切替がフッターにしかなく、スクロールが必要
2. 特にモバイルでは「戻るコスト」が高い
3. URLクエリによる状態連携は実装済みだが、UIがその連携を活かしていない
4. 各ページでNavbarの使い方が統一されていない

## 決定ドライバ

- **モバイルファースト**: メインユーザーはモバイル。親指操作に最適化されたナビゲーションが必要
- **思考モードの切替**: ページ遷移ではなく「モード切替」として位置づける。低コストで行き来できる必要がある
- **状態の連続性**: アセンブリ状態をモード間で引き継ぐ（URLクエリ連携を活用）
- **UIの沈黙**: メイン画面は静かに保ち、ナビゲーションは「必要十分」に
- **PC/Mobile の意味論一貫性**: 配置は異なっても、役割（何ができるか）は同じであるべき
- **既存ツールバーの維持**: Assembly ページのランダムアセンブル、共有等の機能は引き続き提供

## 検討した選択肢

1. フッターリンクのみ（現状維持）
2. ヘッダー内タブバー（PC/Mobile 共通）
3. PC: 二段ヘッダー構造 + Mobile: 下部固定ナビ
4. サイドバーナビゲーション
5. ハンバーガーメニュー

## 決定（採択）

選択したオプション: "3. PC: 二段ヘッダー構造 + Mobile: 下部固定ナビ"

### PC: 二段ヘッダー構造

```text
┌─────────────────────────────────────────────────────┐
│     [ Assembly ]  [ Parts ]  [ AI ]                 │ ← 上段: モードスイッチ
├─────────────────────────────────────────────────────┤
│ Ⅵ                          [ 🎲 🔍 🔓 ↗ 💾 ]       │ ← 下段: 既存ツールバー
└─────────────────────────────────────────────────────┘
```

- **上段（グローバル）**: 思考モード切替。低密度・常時表示
- **下段（ローカル）**: 各モード固有の即時操作。高密度・既存維持

### Mobile: 下部固定ナビ

```text
┌─────────────────────────────────────────────────────┐
│                                                     │
│                   コンテンツ                         │
│                                                     │
├─────────────────────────────────────────────────────┤
│   [ Assembly ]    [ Parts ]    [ AI ]               │ ← 下部ナビ
└─────────────────────────────────────────────────────┘
```

- 親指操作に最適化（画面下部に配置）
- 3項目のみ（シンプル）
- テキスト主体（アイコンのみは避ける）
- 現在地は一瞬で分かる強調

### 採用理由

- **PC**: 二段構造により「モード切替」と「操作」の意味論が完全に分離される
- **Mobile**: iOS/Android のネイティブアプリで広く採用されているパターン。ユーザーの学習コストが低い
- **意味論の一貫性**: PC/Mobile で配置は異なるが、「モード切替 = 最も触りやすい場所」という役割は同じ
- **状態連携**: 既存の `buildQueryFromAssembly()` を活用し、モード間でアセンブリ状態を引き継ぐ

## 影響評価

- セキュリティ: 影響なし
- パフォーマンス: 影響なし（静的なナビゲーション要素の追加のみ）
- ユーザー体験: モード間の移動コストが大幅に低下し、探索的な使い方が促進される
- アクセシビリティ: `aria-current="page"` で現在地を明示。キーボードナビゲーション対応
- トレーサビリティ: 影響なし

### ポジティブな影響

- モード切替が即座に可能になり、ツールの活用度が向上する
- モバイルユーザーの操作性が大幅に改善される
- アセンブリ状態がモード間で引き継がれ、シームレスな作業が可能になる
- PC/Mobile で統一されたナビゲーション体験を提供できる
- 各ページのNavbar使用が統一される

### ネガティブな影響 / トレードオフ

- PC: ヘッダーが二段になり、画面上部の占有面積が増加する
- Mobile: 画面下部に固定ナビが常時表示され、コンテンツ領域が減少する
- 既存のフッターリンクとの重複が発生する（ただし、フッターは「どこからでも戻れる安全網」として維持）
- レイアウト構造の変更を伴うため、影響範囲が広い

## 各選択肢の利点と欠点

### 1. フッターリンクのみ（現状維持）

- 良い点: 実装コストゼロ
- 良い点: 画面領域を圧迫しない
- 悪い点: モード切替にスクロールが必要
- 悪い点: モバイルでの「戻るコスト」が高い
- 悪い点: 「モード切替」という意図が伝わりにくい

### 2. ヘッダー内タブバー（PC/Mobile 共通）

- 良い点: PC/Mobile で同じ配置になり、実装がシンプル
- 良い点: 既存Navbarの構造を活用できる
- 悪い点: モバイルでのヘッダー領域が圧迫される
- 悪い点: 既存ツールバーとの共存が難しい（混雑する）
- 悪い点: モバイルでは親指が届きにくい位置

### 3. PC: 二段ヘッダー構造 + Mobile: 下部固定ナビ

- 良い点: PC/Mobile それぞれに最適化されたUI
- 良い点: 意味論（モード切替 = 最も触りやすい場所）が一貫している
- 良い点: 既存ツールバーとの役割分離が明確
- 良い点: モバイルで親指操作に最適化
- 悪い点: PC/Mobile で実装が分かれ、コードが増える
- 悪い点: レスポンシブブレークポイントの管理が必要

### 4. サイドバーナビゲーション

- 良い点: 多くの項目を整理できる
- 悪い点: 現在の3項目には過剰
- 悪い点: モバイルでの表示が難しい（ドロワーが必要）
- 悪い点: UIの「沈黙」という設計思想に反する

### 5. ハンバーガーメニュー

- 良い点: 画面領域を圧迫しない
- 良い点: 多くの項目を収容できる
- 悪い点: 「隠れたナビゲーション」はモード切替の発見性を下げる
- 悪い点: 操作に2ステップ必要（開く → 選択）
- 悪い点: モバイルでの主要ナビゲーションとしては推奨されない傾向

## フォローアップ / 移行計画

### Phase 5-1: 基盤整備

1. i18nキーの追加（`globalNav.assembly`, `globalNav.parts`, `globalNav.ai`）
2. CSS変数とスタイル定義（`app.scss`）

### Phase 5-2: コンポーネント作成

1. `GlobalNav.svelte`（PC用上段ナビ）
2. `MobileBottomNav.svelte`（Mobile用下部ナビ）

### Phase 5-3: 既存構造への統合

1. `Navbar.svelte` の二段構造化
2. `+layout.svelte` への `MobileBottomNav` 追加
3. `parts-list/+page.svelte` への Navbar 統一適用

### Phase 5-4: 検証

1. URLクエリ連携の動作確認
2. レスポンシブ動作確認
3. アクセシビリティ確認

## 参考リンク

- [UI改善方針](../specs/ui-improvement/PLAN.md)
- [UI改善 実装タスク](../specs/ui-improvement/TASK.md)
- [アクション前宣言 ADR](20260123-action-pre-declaration.md)
